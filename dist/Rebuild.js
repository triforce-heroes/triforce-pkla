import{BufferBuilder as e}from"@triforce-heroes/triforce-core/BufferBuilder";import{messageEncrypt as n}from"./services/Message.js";export function rebuild(t,i){let r=new e,s=new e,g=4+8*t.length;for(let e=0;e<t.length;e++){let l=t[e],d=i.get(l.name)??l.message;r.writeUnsignedInt32(g+s.length),r.writeUnsignedInt16(d.length+1),r.writeUnsignedInt16(l.flags),s.push(n(d,e)),s.pad(4)}let l=new e,d=g+s.length;return l.writeUnsignedInt16(1),l.writeUnsignedInt16(t.length),l.writeUnsignedInt32(d),l.writeUnsignedInt32(0),l.writeUnsignedInt32(16),l.writeUnsignedInt32(d),l.push(r.build()),l.push(s.build()),l.build()}